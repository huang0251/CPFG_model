# A Controllable Perceptual Feature Generative Model for Melody Harmonization via Conditional Variational Autoencoder

This is the repository for the paper: https://doi.org/10.48550/arXiv.2511.14600. The work contains a neural network model for chord inference\melody harmonization\chord progression generation, with controllable params of music perception ( musical tension ). And the function for calculating tonal tension dataset is included, with an example of Bach classic music. The methodology is based on Spiral Array Theory by Chew. 

## Modules in this project

This project contains the following modules and their versions:

- Python 3.11

- music21 6.7.1 (may lead to some errors in higher version)

- numpy 1.24.3

Some modules that use for evaluating & draw are not necessary in basic calculation, and their versions are as follows:

- matplotlib 3.7.1
- scipy 1.10.1
- pandas 1.5.3
- scikit-learn 1.3.0
- seaborn 0.12.2
- statsmodels 0.13.5

## Construction of this project

1. `Proposed_Model` folder is the main project folder of our model and methods. You should use this project with the following steps:

   1.1 `midi_to_tension_bach.py` is used to get MTT data from Bach dataset. (The change of file path is in need, the same below)

   1.2 `mapDatas.py` is used to obtain our BCPT-220K dataset for training.

   1.3 `train.py` is used to train the proposed model.

   1.4 `generate.py` includes several basic functions for reconstruction, prediction and metric test.

   1.5 `test.py` includes several functions for test experiments.

2. `Other_Models` folder includes all comparative models with their settings, such as models of MTT experiments, models of Ablation study, and model of Deepbach. Their training scripts and test scripts are the same of that in the `Proposed_Model` folder.

3. `Subjective_Eval` folder includes experiments on chord progression generation, along with its source audio files and calculation code `run.py` of objective\subjective metrics. The subfolders are described as follows: 

   ​	Folders name start with '0', include raw examples that randomly selected from Bach dataset in music21. 

   ​	Folders name start with '1', include melodies extract from raw files. 

   ​	Folders name start with '2', include raw harmony results in midi form that generated by models with given melody. 

   ​	Folders name start with '3', include midi files that chordified from files in '2' folders by music21. 

   ​	Folders name start with '4', include midi files uncomposed from files in '3'.

   ​	Folders name start with '5', include audio files of midi files in '4'.

